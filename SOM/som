import math

from minisom import MiniSom
from sklearn import datasets
from sklearn.model_selection import train_test_split
from sklearn.metrics import classification_report
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.patches import Patch
from sklearn import datasets
MAX_ITER = 200


def get_data(test_size=0.3,random_state=0):
    iris = datasets.load_iris()
    feature_names = iris.feature_names
    class_names = iris.target_names

    X = iris.data
    y = iris.target
    #7：3划分
    return  train_test_split(X,y,test_size=test_size,random_state=random_state)

X_train, X_test, y_train, y_test = get_data()
N = X_train.shape[0]  #样本数量
M = X_train.shape[1]  #维度/特征数量

size = math.ceil(np.sqrt(5 * np.sqrt(N)))  # 经验公式：决定输出层尺寸

som = MiniSom(size, size, M, sigma=3, learning_rate=0.5,neighborhood_function='bubble')
som.random_weights_init(X_train) #随机初始化
som.train_batch(X_train,MAX_ITER,verbose=False)


